{
  "scopeName": "source.pyx",
  "patterns": [
    { "include": "#dollar-keywords" },
    { "include": "#bang-keywords" },
    { "include": "#macro-usage" },
    { "include": "#variable-assignment" },
    { "include": "source.python" }
  ],
  "repository": {
    "dollar-keywords": {
      "patterns": [
        {
          "comment": "$using A, B, C ... (カンマ区切りリストのハイライト)",
          "begin": "^\\s*(\\$)(using)\\b",
          "beginCaptures": {
            "1": { "name": "keyword.control.import.pyx" },
            "2": { "name": "keyword.control.import.pyx" }
          },
          "end": "$",
          "patterns": [
            {
              "match": "([a-zA-Z_]\\w*)",
              "name": "entity.name.namespace.pyx"
            },
            {
              "match": ",",
              "name": "punctuation.separator.pyx"
            }
          ]
        },
        {
          "comment": "$namespace Name (定義名のハイライト)",
          "match": "^\\s*(\\$)(namespace)\\b(?:\\s+([\\w]+))?",
          "captures": {
            "1": { "name": "keyword.control.import.pyx" },
            "2": { "name": "keyword.control.import.pyx" },
            "3": { "name": "entity.name.namespace.pyx" }
          }
        },
        {
          "comment": "$expand, $cases (その他の引数)",
          "match": "^\\s*(\\$)(expand|cases)\\b(?:\\s+(.*))?",
          "captures": {
            "1": { "name": "keyword.control.import.pyx" },
            "2": { "name": "keyword.control.import.pyx" },
            "3": { "name": "variable.parameter.pyx" }
          }
        },
        {
          "match": "^\\s*\\$",
          "name": "keyword.control.import.pyx"
        }
      ]
    },
    "bang-keywords": {
      "patterns": [
        {
          "match": "^\\s*(!)(define|macro)\\s+(\\w+)(?:\\s*(\\()([^)]*)(\\)))?\\s*:",
          "captures": {
            "1": { "name": "storage.type.pyx" },
            "2": { "name": "storage.type.pyx" },
            "3": { "name": "entity.name.function.pyx" },
            "5": { "name": "variable.parameter.pyx" }
          }
        }
      ]
    },
    "macro-usage": {
      "patterns": [
        {
          "match": "\\b([a-zA-Z_]\\w*)\\s*\\(",
          "captures": {
            "1": { "name": "entity.name.function.pyx" }
          }
        }
      ]
    },
    "variable-assignment": {
      "patterns": [
        {
          "match": "\\b([a-zA-Z_]\\w*)\\s*(?=(,\\s*[a-zA-Z_]\\w*\\s*)*=[^=])",
          "name": "variable.other.readwrite.pyx"
        }
      ]
    }
  }
}